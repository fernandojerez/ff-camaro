/*
 * This build file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * user guide available at https://docs.gradle.org/4.3/userguide/java_library_plugin.html
 */

// Apply the java-library plugin to add support for Java Library
apply plugin: 'java'
apply plugin: 'maven'

sourceCompatibility = 11
targetCompatibility = 11

repositories {
	mavenCentral()
}

dependencies {
    compile gradleApi()
    compile group: 'org.snakeyaml', name: 'snakeyaml-engine', version: '1.0' 
    compileOnly 'org.apache.maven:maven-model:3.5.2'
	compileOnly 'org.apache.maven:maven-model-builder:3.5.2'
} 

jar {
	manifest {
		attributes('Implementation-Title': project_group + '@' + project_name,
				   'Implementation-Version': project_version)
	}
}

if(System.env.FF_BUILD_DIR != null){
	new File(file(System.env.FF_BUILD_DIR), 'ff@camaro/build').mkdirs()
	project.buildDir = new File(file(System.env.FF_BUILD_DIR), 'ff@camaro/build')
}

artifacts {
	archives jar
}

uploadArchives {
    repositories {
        mavenDeployer {
        	String usrHome = System.getProperty("user.home")
        	String repoUrl = "file://" + usrHome + "/.ff"
        	if(System.env.FF_REPO != null){
        		if(!System.env.FF_REPO.contains('://')){
        			repoUrl = 'file://' + System.env.FF_REPO
        		}else{
        			repoUrl = System.env.FF_REPO
        		}
        	}
            repository(url: repoUrl)
            pom.groupId = project_group
            pom.artifactId = project_name
            pom.version = project_version 
        }
    }
}

task publish {
	group 'FF'
	description 'Publish module'
	doLast {
        println 'Module published'
    }
}

publish.dependsOn build
publish.dependsOn uploadArchives